<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ - gear-score.com</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .problem-description {
            background: #fed7d7;
            border: 2px solid #fc8181;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .problem-description h2 {
            color: #c53030;
            margin-top: 0;
        }
        .test-section {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4299e1;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button.danger {
            background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
        }
        .button.success {
            background: linear-gradient(135deg, #68d391 0%, #38a169 100%);
        }
        .log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .status.warning {
            background: #fefcbf;
            color: #744210;
            border: 1px solid #f6e05e;
        }
        .emergency-section {
            background: #fed7d7;
            border: 2px solid #e53e3e;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        .emergency-section h3 {
            color: #c53030;
            margin-top: 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸšª Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</h1>
        
        <div class="problem-description">
            <h2>ğŸ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡Ø§:</h2>
            <p><strong>"Ù„Ù…Ø§ Ø¨Ø¹Ù…Ù„ logout Ø¨ÙŠØ´ÙŠÙ„ Ø§Ù„ÙŠÙˆØ²Ø± ÙÙˆÙ‚ Ø¹Ù„ÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¨Ø³ Ø¨Ø±Ø¬Ø¹ Ø§Ø¹Ù…Ù„ login ØªØ§Ù†ÙŠ Ù…Ø´ Ø¹Ø§Ø±Ù Ø¨ÙŠÙˆØ¯ÙŠÙ†ÙŠ Ù„ÙŠÙ‡ https://gear-score.com/api/auth/error"</strong></p>
            <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ´Ø®ÙŠØµ ÙˆØ­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ.</p>
        </div>

        <div class="test-section">
            <h3>ğŸ” Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
            <button class="button" onclick="checkCurrentSession()">ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
            <button class="button" onclick="testLogoutEndpoints()">Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            <button class="button" onclick="checkCookies()">ÙØ­Øµ Ø§Ù„ÙƒÙˆÙƒÙŠØ²</button>
            <button class="button" onclick="testAuthFlow()">Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
        </div>

        <div class="test-section">
            <h3>ğŸ› ï¸ Ø­Ù„ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</h3>
            <button class="button success" onclick="performEnhancedLogout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù…Ø­Ø³Ù†</button>
            <button class="button" onclick="performStandardLogout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¹Ø§Ø¯ÙŠ</button>
            <button class="button" onclick="performForceLogout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù‚Ø³Ø±ÙŠ</button>
        </div>

        <div class="test-section">
            <h3>ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <button class="button" onclick="clearLocalStorage()">Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ</button>
            <button class="button" onclick="clearSessionStorage()">Ù…Ø³Ø­ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø©</button>
            <button class="button danger" onclick="clearAllCookies()">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙˆÙƒÙŠØ²</button>
            <button class="button danger" onclick="performCompleteCleanup()">ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„</button>
        </div>

        <div id="status"></div>
        <div id="log" class="log"></div>

        <div class="emergency-section">
            <h3>ğŸ†˜ Ø­Ù„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h3>
            <p>Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ù…Ù„ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø£Ø¹Ù„Ø§Ù‡ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØµÙØ­ (F12):</p>
            <div class="code-block" id="emergencyCode">
// ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦
localStorage.clear();
sessionStorage.clear();
document.cookie.split(";").forEach(c => {
  const cookieName = c.replace(/^ +/, "").replace(/=.*/, "");
  // Ù…Ø³Ø­ Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ
  document.cookie = cookieName + "=;expires=" + new Date().toUTCString() + ";path=/";
  // Ù…Ø³Ø­ Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„ÙØ±Ø¹ÙŠ
  document.cookie = cookieName + "=;expires=" + new Date().toUTCString() + ";path=/;domain=.gear-score.com";
  // Ù…Ø³Ø­ Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
  document.cookie = cookieName + "=;expires=" + new Date().toUTCString() + ";path=/;domain=gear-score.com";
});
// Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
window.location.href="/auth";
            </div>
            <button class="button danger" onclick="copyEmergencyCode()">Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</button>
        </div>
    </div>

    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            const logMessage = `[${timestamp}] ${message}\n`;
            log.textContent += logMessage;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        function setStatus(message, type = 'info') {
            status.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function makeRequest(url, options = {}) {
            try {
                addLog(`ğŸ”„ Ø·Ù„Ø¨ Ø¥Ù„Ù‰: ${url}`);
                const response = await fetch(url, {
                    credentials: 'include',
                    ...options
                });
                
                addLog(`ğŸ“¡ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${response.status} ${response.statusText}`);
                
                // Log cookies from response
                const cookies = response.headers.get('set-cookie');
                if (cookies) {
                    addLog(`ğŸª ÙƒÙˆÙƒÙŠØ² Ø¬Ø¯ÙŠØ¯Ø©: ${cookies}`);
                }
                
                return response;
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                return null;
            }
        }

        async function checkCurrentSession() {
            addLog('ğŸ” ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©...');
            const response = await makeRequest('/api/auth/session');
            
            if (response) {
                const data = await response.text();
                if (data && data !== '{}' && data !== 'null') {
                    addLog('âœ… ÙŠÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©');
                    addLog(`ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©: ${data}`);
                    setStatus('ÙŠÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©', 'success');
                } else {
                    addLog('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©');
                    setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©', 'warning');
                }
            }
        }

        async function testLogoutEndpoints() {
            addLog('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‚Ø§Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...');
            
            const endpoints = [
                { name: 'NextAuth Signout', url: '/api/auth/signout', method: 'POST' },
                { name: 'Enhanced Logout', url: '/api/logout-improved', method: 'POST' },
                { name: 'Force Logout', url: '/api/force-logout', method: 'POST' }
            ];
            
            for (const endpoint of endpoints) {
                addLog(`ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø±: ${endpoint.name}`);
                const response = await makeRequest(endpoint.url, { method: endpoint.method });
                
                if (response && response.ok) {
                    addLog(`âœ… ${endpoint.name}: ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­`);
                } else {
                    addLog(`âŒ ${endpoint.name}: ÙØ´Ù„`);
                }
            }
        }

        function checkCookies() {
            addLog('ğŸª ÙØ­Øµ Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ø§Ù„Ø­Ø§Ù„ÙŠØ©...');
            const cookies = document.cookie.split(';');
            
            if (cookies.length === 1 && cookies[0] === '') {
                addLog('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆÙƒÙŠØ²');
                setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆÙƒÙŠØ²', 'warning');
            } else {
                addLog(`ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆÙƒÙŠØ²: ${cookies.length}`);
                cookies.forEach((cookie, index) => {
                    const cookieName = cookie.split('=')[0].trim();
                    addLog(`   ${index + 1}. ${cookieName}`);
                });
                setStatus(`ÙŠÙˆØ¬Ø¯ ${cookies.length} ÙƒÙˆÙƒÙŠØ²`, 'info');
            }
        }

        async function testAuthFlow() {
            addLog('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...');
            
            // Test auth page
            const authResponse = await makeRequest('/auth');
            if (authResponse && authResponse.ok) {
                addLog('âœ… ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªØ§Ø­Ø©');
            } else {
                addLog('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©');
            }
            
            // Test error page
            const errorResponse = await makeRequest('/api/auth/error');
            addLog(`ğŸ“„ ØµÙØ­Ø© Ø§Ù„Ø®Ø·Ø£: ${errorResponse ? errorResponse.status : 'ØºÙŠØ± Ù…ØªØ§Ø­'}`);
        }

        async function performEnhancedLogout() {
            addLog('ğŸšª ØªÙ†ÙÙŠØ° ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù…Ø­Ø³Ù†...');
            setStatus('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...', 'info');
            
            const response = await makeRequest('/api/logout-improved', { method: 'POST' });
            
            if (response && response.ok) {
                addLog('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù†Ø¬Ø§Ø­');
                setStatus('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                // Clear client-side data
                clearLocalStorage();
                clearSessionStorage();
                
                setTimeout(() => {
                    addLog('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...');
                    window.location.href = '/auth';
                }, 2000);
            } else {
                addLog('âŒ ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø­Ø³Ù†');
                setStatus('ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        async function performStandardLogout() {
            addLog('ğŸšª ØªÙ†ÙÙŠØ° ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¹Ø§Ø¯ÙŠ...');
            const response = await makeRequest('/api/auth/signout', { method: 'POST' });
            
            if (response) {
                addLog('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø¹Ø§Ø¯ÙŠ');
                setTimeout(() => window.location.href = '/auth', 1000);
            }
        }

        async function performForceLogout() {
            addLog('ğŸšª ØªÙ†ÙÙŠØ° ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù‚Ø³Ø±ÙŠ...');
            const response = await makeRequest('/api/force-logout', { method: 'POST' });
            
            if (response) {
                addLog('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù‚Ø³Ø±ÙŠ');
                clearLocalStorage();
                clearSessionStorage();
                setTimeout(() => window.location.href = '/auth', 1000);
            }
        }

        function clearLocalStorage() {
            const itemCount = localStorage.length;
            localStorage.clear();
            addLog(`ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ (${itemCount} Ø¹Ù†ØµØ±)`);
        }

        function clearSessionStorage() {
            const itemCount = sessionStorage.length;
            sessionStorage.clear();
            addLog(`ğŸ§¹ ØªÙ… Ù…Ø³Ø­ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø© (${itemCount} Ø¹Ù†ØµØ±)`);
        }

        function clearAllCookies() {
            const cookies = document.cookie.split(';');
            let clearedCount = 0;
            
            cookies.forEach(cookie => {
                const eqPos = cookie.indexOf('=');
                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                
                if (name) {
                    // Clear for current domain
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
                    // Clear for .gear-score.com
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.gear-score.com';
                    // Clear for gear-score.com
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=gear-score.com';
                    clearedCount++;
                }
            });
            
            addLog(`ğŸ§¹ ØªÙ… Ù…Ø³Ø­ ${clearedCount} ÙƒÙˆÙƒÙŠØ²`);
        }

        function performCompleteCleanup() {
            addLog('ğŸ§¹ ØªÙ†ÙÙŠØ° ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„...');
            clearLocalStorage();
            clearSessionStorage();
            clearAllCookies();
            
            setStatus('ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø´Ø§Ù…Ù„!', 'success');
            
            setTimeout(() => {
                addLog('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
                window.location.reload();
            }, 2000);
        }

        function copyEmergencyCode() {
            const code = document.getElementById('emergencyCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                addLog('ğŸ“‹ ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦');
                setStatus('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ - Ø§Ù„ØµÙ‚Ù‡ ÙÙŠ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØµÙØ­ (F12)', 'success');
            }).catch(() => {
                addLog('âŒ ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯');
            });
        }

        // Initialize
        addLog('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
        addLog('ğŸ’¡ Ø§Ø¨Ø¯Ø£ Ø¨ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©');
    </script>
</body>
</html>