# ุญู ูุดุงูู Discord OAuth ูู ุงูุฅูุชุงุฌ ๐

## ุงููุดุงูู ุงููุญุฏุฏุฉ:
- โ ุชุณุฌูู ุงูุฏุฎูู ุจู Discord ูุง ูุนูู
- โ ุนุฏู ุนูู logout ุจุดูู ุตุญูุญ
- โ logout ุชููุงุฆู ุนูุฏ refresh ุงูุตูุญุฉ

## ุงูุญููู ุงููุทุจูุฉ:

### 1๏ธโฃ ุชุญุฏูุซ Discord Client Secret

**ูู ููู `.env.production`:**
```env
DISCORD_CLIENT_ID=1389217214409998468
DISCORD_CLIENT_SECRET=0GY6w9pUZ65e_D7dqFQZRUzibKnPwZn0
NEXTAUTH_URL=https://gear-score.com
```

### 2๏ธโฃ ุฅุตูุงุญ ุฅุนุฏุงุฏุงุช ุงูุฌูุณุงุช ูุงูููููุฒ

**ุงูุชุญุฏูุซุงุช ูู `[...nextauth].ts`:**

#### ุฃ) ุฒูุงุฏุฉ ูุฏุฉ ุงูุฌูุณุฉ:
```javascript
session: {
  strategy: "jwt" as const,
  maxAge: 30 * 24 * 60 * 60, // 30 ููู ุจุฏูุงู ูู 7 ุฃูุงู
  updateAge: 24 * 60 * 60, // ุชุญุฏูุซ ูู 24 ุณุงุนุฉ
},
```

#### ุจ) ุฅุตูุงุญ ุฅุนุฏุงุฏุงุช ุงูููููุฒ:
```javascript
cookies: {
  sessionToken: {
    name: `next-auth.session-token`,
    options: {
      httpOnly: true,
      sameSite: 'lax',
      path: '/',
      secure: process.env.NODE_ENV === 'production',
      maxAge: 30 * 24 * 60 * 60, // 30 ููู
      domain: undefined // ุฅุฒุงูุฉ ูููุฏ ุงูุฏูููู ูุญู ูุดุงูู logout
    }
  },
  // ... ุจุงูู ุฅุนุฏุงุฏุงุช ุงูููููุฒ
}
```

### 3๏ธโฃ ุงูุชุฃูุฏ ูู Redirect URI ูู Discord Developer Portal

**ูุฌุจ ุฅุถุงูุฉ ูุฐุง ุงูุฑุงุจุท ูู Discord Developer Portal:**
```
https://gear-score.com/api/auth/callback/discord
```

**ุฎุทูุงุช ุงูุฅุถุงูุฉ:**
1. ุงุฐูุจ ุฅูู [Discord Developer Portal](https://discord.com/developers/applications)
2. ุงุฎุชุฑ ุงูุชุทุจูู ุจู Client ID: `1389217214409998468`
3. ุงุฐูุจ ุฅูู ุชุจููุจ "OAuth2"
4. ูู ูุณู "Redirects"ุ ุฃุถู ุงูุฑุงุจุท ุฃุนูุงู
5. ุงุญูุธ ุงูุชุบููุฑุงุช

### 4๏ธโฃ ูุดุฑ ุงูุชุญุฏูุซุงุช ุนูู ุงูุณูุฑูุฑ

**ุฎุทูุงุช ุงููุดุฑ:**

#### ุฃ) ุฑูุน ุงูููุฏ ุฅูู GitHub:
```bash
git add .
git commit -m "Fix Discord OAuth and session issues for production"
git push origin main
```

#### ุจ) ุนูู ุงูุณูุฑูุฑ:
```bash
# ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช
git pull origin main

# ูุณุฎ ููู ุงูุจูุฆุฉ ููุฅูุชุงุฌ
cp .env.production .env

# ุชุซุจูุช ุงูุชุจุนูุงุช (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
npm install

# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
pm2 restart gearscore
# ุฃู
npm run build && npm start
```

### 5๏ธโฃ ุงุฎุชุจุงุฑ ุงูุญู

**ุฑุงุจุท ุงุฎุชุจุงุฑ Discord OAuth:**
```
https://discord.com/api/oauth2/authorize?client_id=1389217214409998468&redirect_uri=https%3A%2F%2Fgear-score.com%2Fapi%2Fauth%2Fcallback%2Fdiscord&response_type=code&scope=identify+email&prompt=consent
```

**ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:**
1. ุงูุณุญ ุฌููุน ุงูููููุฒ ูู ุงููุชุตูุญ
2. ุงุฐูุจ ุฅูู `https://gear-score.com/auth`
3. ุงุถุบุท ุนูู "ุชุณุฌูู ุงูุฏุฎูู ุจุงูุฏูุณููุฑุฏ"
4. ุฃููู ุนูููุฉ ุงูุชุณุฌูู ูู Discord
5. ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ุงููุงุฌุญ
6. ุฌุฑุจ refresh ุงูุตูุญุฉ ููุชุฃูุฏ ูู ุนุฏู ุญุฏูุซ logout ุชููุงุฆู
7. ุฌุฑุจ logout ูุฏููุงู ููุชุฃูุฏ ูู ุนููู

## ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง:

### โ "Invalid OAuth2 redirect_uri"
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุถุงูุฉ `https://gear-score.com/api/auth/callback/discord` ูู Discord Developer Portal

### โ "Invalid client_secret"
**ุงูุญู:** ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู Client Secret ุงูุฌุฏูุฏ: `0GY6w9pUZ65e_D7dqFQZRUzibKnPwZn0`

### โ Logout ุชููุงุฆู ุนูุฏ refresh
**ุงูุญู:** ุชู ุฅุตูุงุญู ุจุฅุฒุงูุฉ ูููุฏ ุงูุฏูููู ูู ุฅุนุฏุงุฏุงุช ุงูููููุฒ

### โ ุงูุฌูุณุฉ ุชูุชูู ุจุณุฑุนุฉ
**ุงูุญู:** ุชู ุฒูุงุฏุฉ ูุฏุฉ ุงูุฌูุณุฉ ุฅูู 30 ููู

## ุงูุชุญูู ูู ุงูุญุงูุฉ:

### โ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ:
- [x] ุชุญุฏูุซ Discord Client Secret ูู `.env.production`
- [x] ุฅุตูุงุญ ุฅุนุฏุงุฏุงุช ุงูุฌูุณุงุช (30 ููู)
- [x] ุฅุฒุงูุฉ ูููุฏ ุงูุฏูููู ูู ุงูููููุฒ
- [ ] ุฑูุน ุงูุชุญุฏูุซุงุช ุฅูู GitHub
- [ ] ูุดุฑ ุงูุชุญุฏูุซุงุช ุนูู ุงูุณูุฑูุฑ
- [ ] ุฅุถุงูุฉ Redirect URI ูู Discord Developer Portal
- [ ] ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
- [ ] ุงุฎุชุจุงุฑ logout
- [ ] ุงุฎุชุจุงุฑ refresh ุงูุตูุญุฉ

## ููุงุญุธุงุช ูููุฉ:

1. **ุงูุฃูุงู:** ุชู ุงูุญูุงุธ ุนูู ุฌููุน ุฅุนุฏุงุฏุงุช ุงูุฃูุงู (httpOnly, secure, etc.)
2. **ุงูุชูุงูู:** ุงูุญู ูุนูู ูุน ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
3. **ุงูุฃุฏุงุก:** ูุง ูุคุซุฑ ุนูู ุฃุฏุงุก ุงููููุน
4. **Debug Mode:** ูููุนู ููุฑุงูุจุฉ ุฃู ูุดุงูู ุฌุฏูุฏุฉ

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 2025-08-10  
**ุงูุญุงูุฉ:** ุฌุงูุฒ ูููุดุฑ โ